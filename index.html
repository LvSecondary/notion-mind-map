<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Creador de Mapas Mentales</title>
  <style>
    body { margin:0; background:#1e1e1e; color:white; font-family:sans-serif; overflow:hidden; }
    #toolbar { position:fixed; top:10px; left:10px; background:#333; padding:10px; border-radius:8px; }
    button { margin:2px; padding:6px 10px; border:none; border-radius:5px; background:#555; color:white; cursor:pointer; }
    button:hover { background:#777; }
    svg { width:100vw; height:100vh; }
    .node { fill:#4cafef; stroke:#0f172a; stroke-width:2; cursor:move; }
    .node-text { fill:white; font-size:14px; pointer-events:none; }
    line { stroke:white; stroke-width:2; marker-end:url(#arrow); }
  </style>
</head>
<body>
  <div id="toolbar">
    <button onclick="addNode()">‚ûï Nodo</button>
    <button onclick="connectMode()">üîó Conectar</button>
    <button onclick="deleteMode()">‚ùå Borrar</button>
  </div>
  <svg id="mindmap">
    <defs>
      <marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
        <path d="M0,0 L0,6 L9,3 z" fill="white" />
      </marker>
    </defs>
  </svg>

  <script>
    const svg = document.getElementById("mindmap");
    let nodeId = 0;
    let selected = null;
    let mode = "move";
    let startNode = null;

    function addNode() {
      const g = document.createElementNS("http://www.w3.org/2000/svg","g");
      g.setAttribute("class","node-group");
      g.setAttribute("transform",`translate(${100+nodeId*20},100)`);
      g.dataset.id = nodeId;

      const circle = document.createElementNS("http://www.w3.org/2000/svg","circle");
      circle.setAttribute("r",40);
      circle.setAttribute("class","node");

      const text = document.createElementNS("http://www.w3.org/2000/svg","text");
      text.setAttribute("class","node-text");
      text.setAttribute("text-anchor","middle");
      text.setAttribute("dy",".3em");
      text.textContent = "Nodo "+nodeId;

      g.appendChild(circle);
      g.appendChild(text);
      svg.appendChild(g);

      g.addEventListener("mousedown", startDrag);
      g.addEventListener("mouseup", endDrag);
      g.addEventListener("dblclick", editText);
      g.addEventListener("click", handleClick);

      nodeId++;
    }

    function editText(e) {
      const textEl = e.currentTarget.querySelector("text");
      const newText = prompt("Editar texto:", textEl.textContent);
      if (newText) textEl.textContent = newText;
    }

    function connectMode() { mode="connect"; }
    function deleteMode() { mode="delete"; }
    function startDrag(e) {
      if (mode==="move") {
        selected = e.currentTarget;
        svg.addEventListener("mousemove", drag);
      }
    }
    function drag(e) {
      if (selected) {
        const CTM = svg.getScreenCTM();
        const x = (e.clientX - CTM.e) / CTM.a;
        const y = (e.clientY - CTM.f) / CTM.d;
        selected.setAttribute("transform",`translate(${x},${y})`);
      }
    }
    function endDrag() {
      selected=null;
      svg.removeEventListener("mousemove", drag);
    }

    function handleClick(e) {
      const g = e.currentTarget;
      if (mode==="connect") {
        if (!startNode) {
          startNode=g;
        } else {
          const line = document.createElementNS("http://www.w3.org/2000/svg","line");
          const [x1,y1]=getCenter(startNode);
          const [x2,y2]=getCenter(g);
          line.setAttribute("x1",x1);
          line.setAttribute("y1",y1);
          line.setAttribute("x2",x2);
          line.setAttribute("y2",y2);
          svg.insertBefore(line,svg.firstChild);
          startNode=null;
          mode="move";
        }
      } else if (mode==="delete") {
        g.remove();
        mode="move";
      }
    }

    function getCenter(g) {
      const transform=g.getAttribute("transform");
      const match=transform.match(/translate\(([^,]+),([^\)]+)\)/);
      return [parseFloat(match[1]), parseFloat(match[2])];
    }
  </script>
</body>
</html>
